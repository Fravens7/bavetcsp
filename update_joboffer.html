<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Test Supabase Job Posts</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

  <h1>Ofertas de Trabajo desde Supabase</h1>
  <div id="job-listings"></div>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      const supabaseUrl = 'https://hxnikfmwknlxmkqcsrol.supabase.co';
      const supabaseKey = 'tu_api_key_aqui'; // Reemplaza con tu clave de API
      const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);  // Creación correcta del cliente

      const container = document.getElementById('job-listings');

      try {
        const { data: jobs, error } = await supabaseClient.from('job_posts').select('*');
        if (error) throw error;

        if (!jobs || jobs.length === 0) {
          container.innerHTML = '<p>No hay ofertas disponibles.</p>';
          return;
        }

        container.innerHTML = jobs.map(job => `
          <div>
            <h3>${job.title}</h3>
            <p><strong>Departamento:</strong> ${job.department}</p>
            <p><strong>Tipo:</strong> ${job.type}</p>
            <p><strong>Ubicación:</strong> ${job.location}</p>
            <p><strong>Descripción:</strong> ${job.description}</p>

            <h4>Responsabilidades:</h4>
            <ul>
              ${(job.responsibilities || '').split('\n').map(item => `<li>${item.trim()}</li>`).join('')}
            </ul>

            <h4>Requisitos:</h4>
            <ul>
              ${(job.requirements || '').split('\n').map(item => `<li>${item.trim()}</li>`).join('')}
            </ul>

            <h4>Beneficios:</h4>
            <ul>
              ${(job.benefits || '').split('\n').map(item => `<li>${item.trim()}</li>`).join('')}
            </ul>

            <p><strong>Modalidad de trabajo:</strong> ${job.work_setup}</p>

            <button onclick="editJob(${job.id}, '${job.title}', '${job.department}', '${job.type}', '${job.location}', '${job.description}', '${job.responsibilities}', '${job.requirements}', '${job.benefits}', '${job.work_setup}')">Editar</button>
          </div>
        `).join('');

      } catch (error) {
        container.innerHTML = `<p>Error al cargar datos: ${error.message}</p>`;
      }
    });

    function editJob(id, title, department, type, location, description, responsibilities, requirements, benefits, work_setup) {
      // Mostrar formulario de edición con los datos actuales
      const formHTML = `
        <h3>Editar Oferta de Trabajo</h3>
        <form id="edit-form">
          <input type="hidden" name="id" value="${id}" />
          <label for="title">Título:</label>
          <input type="text" id="title" name="title" value="${title}" required><br><br>
          
          <label for="department">Departamento:</label>
          <input type="text" id="department" name="department" value="${department}" required><br><br>
          
          <label for="type">Tipo:</label>
          <input type="text" id="type" name="type" value="${type}" required><br><br>
          
          <label for="location">Ubicación:</label>
          <input type="text" id="location" name="location" value="${location}" required><br><br>
          
          <label for="description">Descripción:</label>
          <textarea id="description" name="description" required>${description}</textarea><br><br>
          
          <label for="responsibilities">Responsabilidades:</label>
          <textarea id="responsibilities" name="responsibilities">${responsibilities}</textarea><br><br>
          
          <label for="requirements">Requisitos:</label>
          <textarea id="requirements" name="requirements">${requirements}</textarea><br><br>
          
          <label for="benefits">Beneficios:</label>
          <textarea id="benefits" name="benefits">${benefits}</textarea><br><br>
          
          <label for="work_setup">Modalidad de trabajo:</label>
          <input type="text" id="work_setup" name="work_setup" value="${work_setup}" required><br><br>

          <button type="submit">Guardar cambios</button>
        </form>
      `;

      document.getElementById('job-listings').innerHTML = formHTML;

      document.getElementById('edit-form').addEventListener('submit', async (e) => {
        e.preventDefault();

        const id = e.target.id.value;
        const updates = {
          title: e.target.title.value,
          department: e.target.department.value,
          type: e.target.type.value,
          location: e.target.location.value,
          description: e.target.description.value,
          responsibilities: e.target.responsibilities.value,
          requirements: e.target.requirements.value,
          benefits: e.target.benefits.value,
          work_setup: e.target.work_setup.value
        };

        try {
          const { data, error } = await supabaseClient
            .from('job_posts')
            .update(updates)
            .eq('id', id);
          
          if (error) throw error;

          alert('Oferta actualizada correctamente');
          location.reload(); // Recarga la página para mostrar los cambios
        } catch (error) {
          alert('Error al actualizar: ' + error.message);
        }
      });
    }
  </script>

</body>
</html>
