<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Editar Vacante</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f4f7f6; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .admin-container { background: white; padding: 40px; border-radius: 12px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); width: 100%; max-width: 800px; }
        h1 { color: #2c3e50; text-align: center; margin-bottom: 30px; }
        label { display: block; margin-top: 20px; font-weight: 600; color: #34495e; }
        input, textarea { width: 100%; padding: 12px; margin-top: 8px; border: 1px solid #bdc3c7; border-radius: 6px; font-size: 16px; box-sizing: border-box; transition: border-color 0.3s; }
        input:focus, textarea:focus { outline: none; border-color: #3498db; }
        textarea { min-height: 120px; resize: vertical; }
        .btn { background-color: #3498db; color: white; padding: 12px 25px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: bold; width: 100%; margin-top: 25px; transition: background-color 0.3s; }
        .btn:hover { background-color: #2980b9; }
        .status { margin-top: 20px; padding: 15px; border-radius: 6px; text-align: center; font-weight: bold; }
        .status.success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status.error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        /* Estilos para la pantalla de login */
        #login-container { text-align: center; }
        #login-container input { margin-bottom: 20px; }
    </style>
</head>
<body>

    <div class="admin-container">
        <!-- Pantalla de "Login" (oculta por defecto) -->
        <div id="login-container">
            <h1>Panel de Administración</h1>
            <p>Por favor, introduce la contraseña para continuar.</p>
            <input type="password" id="password-input" placeholder="Contraseña">
            <button class="btn" onclick="checkPassword()">Entrar</button>
        </div>

        <!-- Formulario de Edición (oculto por defecto) -->
<!-- Formulario de Edición (oculto por defecto) -->
<div id="edit-form-container" style="display: none;">
    <h1>Edit Job Vacancy</h1>
    <form id="job-form">
        <label for="department">Department</label>
        <input type="text" id="department" name="department" required>

        <label for="type">Type</label>
        <input type="text" id="type" name="type" required>

        <label for="career_level">Career Level</label>
        <input type="text" id="career_level" name="career_level" required>

        <label for="description">Description</label>
        <textarea id="description" name="description" required></textarea>

        <label for="responsibilities">Key Responsibilities (one per line)</label>
        <textarea id="responsibilities" name="responsibilities" required></textarea>

        <label for="requirements">Requirements (one per line)</label>
        <textarea id="requirements" name="requirements" required></textarea>

        <label for="benefits">Benefits (one per line)</label>
        <textarea id="benefits" name="benefits" required></textarea>

        <label for="work_setup">Work Setup</label>
        <input type="text" id="work_setup" name="work_setup" required>

        <button type="submit" class="btn">Save Changes</button>
    </form>
    <div id="status-message"></div>
</div>
    </div>

    <!-- Añade el cliente de Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.min.js"></script>
    <script>
        // --- CONFIGURACIÓN ---
        const SUPABASE_URL = 'https://hxnikfmwknlxmkqcsrol.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh4bmlrZm13a25seG1rcWNzcm9sIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk1OTUwNTksImV4cCI6MjA3NTE3MTA1OX0.G2b3hFEvpvOFpiFFk_a2os-7mFOgsZz6pj_YMihvv5A';
        
        // --- CAMBIA ESTA CONTRASEÑA ---
        const ADMIN_PASSWORD = 'neuron2025'; 

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // --- LÓGICA DE LOGIN ---
        function checkPassword() {
            const passwordInput = document.getElementById('password-input').value;
            if (passwordInput === ADMIN_PASSWORD) {
                document.getElementById('login-container').style.display = 'none';
                document.getElementById('edit-form-container').style.display = 'block';
                loadJobData(); // Cargar los datos una vez que se accede
            } else {
                alert('Incorrect password. Please try again.');
            }
        }

        // Permitir entrar con la tecla "Enter"
        document.getElementById('password-input').addEventListener('keyup', function(event) {
            if (event.key === 'Enter') {
                checkPassword();
            }
        });

        // --- LÓGICA DEL FORMULARIO ---
        const form = document.getElementById('job-form');
        const statusDiv = document.getElementById('status-message');

        // Cargar los datos actuales de Supabase
        async function loadJobData() {
            const { data, error } = await supabase
                .from('job_posts')
                .select('*')
                .eq('id', 1) // Asumimos que siempre editaremos la fila con id=1
                .single();

            if (error) {
                console.error('Error al cargar datos:', error);
                statusDiv.textContent = 'Error saving changes.';
                statusDiv.className = 'status error';
                return;
            }

            if (data) {
                // Rellenar el formulario con los datos existentes
                Object.keys(data).forEach(key => {
                    const input = document.querySelector(`[name="${key}"]`);
                    if (input) {
                        input.value = data[key] || '';
                    }
                });
            }
        }

        // Guardar los cambios en Supabase
// Guardar los cambios en Supabase
// Guardar los cambios en Supabase
// Guardar los cambios en Supabase
form.addEventListener('submit', async (e) => {
    e.preventDefault();
    statusDiv.textContent = 'Saving...';
    statusDiv.className = 'status';



    
    const formData = new FormData(form);
    const updatedData = Object.fromEntries(formData.entries());

    console.log("Datos a enviar a Supabase:", updatedData);

    // --- CAMBIO CLAVE: Simplificamos la respuesta y solo comprobamos el error ---
    const { data, error } = await supabase
        .from('job_posts')
        .update(updatedData)
        .eq('id', 1);

    if (error) {
        // Si hay un error explícito, lo mostramos
        console.error('Supabase explicit error:', error);
        statusDiv.textContent = `Error saving changes: ${error.message}`;
        statusDiv.className = 'status error';
    } else {
        // Si NO hay error, damos el éxito por sentado
        console.log("Supabase no devolvió error. Asumiendo éxito.");
        statusDiv.textContent = 'Changes saved successfully!';
        statusDiv.className = 'status success';
    }
});
    </script>
</body>
</html>
